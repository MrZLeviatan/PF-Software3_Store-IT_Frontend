<app-fondo-animado></app-fondo-animado>

<div class="productos-panel">
  <h2 class="titulo">üõí Cat√°logo de Productos</h2>

  <!-- Filtros de b√∫squeda -->
  <div class="filtros">
    <label for="tipo">Tipo:</label>
    <select
      id="tipo"
      [(ngModel)]="tipoSeleccionado"
      (change)="filtrarProductos()"
      class="select-filtro"
    >
      <option value="">Todos</option>
      <option *ngFor="let tipo of tipos" [value]="tipo">{{ tipo }}</option>
    </select>

    <label for="proveedor">Proveedor:</label>
    <select
      id="proveedor"
      [(ngModel)]="proveedorSeleccionado"
      (change)="filtrarProductos()"
      class="select-filtro"
    >
      <option value="">Todos</option>
      <option *ngFor="let proveedor of proveedores" [value]="proveedor.id">
        {{ proveedor.nombre }} - {{ proveedor.marca }}
      </option>
    </select>
  </div>

  <!-- Mensajes de carga o sin resultados -->
  <div *ngIf="cargando" class="estado">Cargando productos...</div>
  <div *ngIf="!cargando && productos.length === 0" class="estado">No se encontraron productos.</div>

  <!-- Cuadr√≠cula de productos -->
  <div class="productos-grid" *ngIf="!cargando && productos.length > 0">
    <div
      class="producto-card"
      *ngFor="let producto of productos"
      (click)="mostrarDetallesProducto(producto)"
    >
      <img [src]="producto.imagen" alt="{{ producto.nombre }}" class="imagen-producto" />
      <div class="info-producto">
        <h3>{{ producto.nombre }}</h3>
        <p><strong>Tipo:</strong> {{ producto.tipoProducto }}</p>
        <p><strong>C√≥digo:</strong> {{ producto.codigoBarras }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Panel centrado de detalles -->
<div class="detalle-overlay" *ngIf="productoSeleccionado" (click)="cerrarDetalles()">
  x
  <div class="detalle-modal" (click)="$event.stopPropagation()">
    <button class="cerrar-btn" (click)="cerrarDetalles()">‚úï</button>

    <!-- Contenedor principal: Imagen e info lado a lado -->
    <div class="detalle-principal">
      <!-- Imagen del producto -->
      <div class="detalle-imagen-contenedor">
        <img
          [src]="productoSeleccionado.imagen"
          class="detalle-imagen"
          alt="{{ productoSeleccionado.nombre }}"
        />
      </div>

      <!-- Informaci√≥n del producto y proveedor -->
      <div class="detalle-info">
        <h2>{{ productoSeleccionado.nombre }}</h2>
        <p class="detalle-precio">
          <strong>Valor Compra:</strong>
          {{ productoSeleccionado.valorCompra | currency : 'USD' : 'symbol' : '1.0-0' }}<br />
          <strong>Valor Venta:</strong>
          {{ productoSeleccionado.valorVenta | currency : 'USD' : 'symbol' : '1.0-0' }}
        </p>
        <p><strong>Tipo:</strong> {{ productoSeleccionado.tipoProducto }}</p>
        <p><strong>C√≥digo de barras:</strong> {{ productoSeleccionado.codigoBarras }}</p>

        <hr />

        <div *ngIf="proveedorSeleccionadoDetalles; else noProveedor">
          <h3>üè¢ Proveedor</h3>
          <p><strong>Nombre:</strong> {{ proveedorSeleccionadoDetalles.nombre }}</p>
          <p><strong>Marca:</strong> {{ proveedorSeleccionadoDetalles.marca }}</p>
          <p><strong>Email:</strong> {{ proveedorSeleccionadoDetalles.email }}</p>
          <p><strong>Tel√©fono:</strong> {{ proveedorSeleccionadoDetalles.telefono }}</p>
        </div>
        <ng-template #noProveedor>
          <div class="estado">No se encontr√≥ informaci√≥n del proveedor.</div>
        </ng-template>
      </div>
    </div>
    `

    <!-- Secci√≥n de Espacio del Producto -->
    <div *ngIf="espacioProducto" class="seccion-espacio">
      <h3 class="titulo-espacio">Espacio del Producto</h3>

      <div class="espacio-contenedor">
        <!-- Esfera 3D a la izquierda -->
        <div class="esfera-lado">
          <div
            class="esfera-3d"
            [ngStyle]="{
              '--porcentaje': espacioProducto.unidadAlmacenamiento.porcentajeOcupacion + '%',
              '--color': obtenerColorOcupacion(
                espacioProducto.unidadAlmacenamiento.porcentajeOcupacion
              )
            }"
          ></div>
          <div class="porcentaje-texto">
            {{ espacioProducto.unidadAlmacenamiento.porcentajeOcupacion | number : '1.0-0' }}%
          </div>
        </div>

        <!-- Informaci√≥n del espacio a la derecha -->
        <div class="info-espacio">
          <p>
            <strong>Volumen total:</strong>
            {{ espacioProducto.unidadAlmacenamiento.volumenTotal | number : '1.0-2' }} m¬≥
          </p>
          <p>
            <strong>Volumen ocupado:</strong>
            {{ espacioProducto.unidadAlmacenamiento.volumenOcupado | number : '1.0-2' }} m¬≥
          </p>
          <p>
            <strong>Volumen disponible:</strong>
            {{ espacioProducto.unidadAlmacenamiento.volumenDisponible | number : '1.0-2' }} m¬≥
          </p>
          <p>
            <strong>Estado unidad:</strong>
            {{ espacioProducto.unidadAlmacenamiento.estadoUnidad }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
